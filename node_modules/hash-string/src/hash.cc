#include <node.h>
#include <v8.h>

using namespace v8;

Handle<Value> hashCode(const Arguments& args) {
  HandleScope scope;
  Local<Value> arg = args[0];
  if (arg->IsString()) {
    String::Utf8Value utf8(arg);
    int len = utf8.length();
    char* s = *utf8;
    int off = 0;
    int h = 0;

    for (int i = 0; i < len; i++) {
      h = 31*h + s[off++];
    }

    return scope.Close(Integer::New(h));
  }
  return scope.Close(Integer::New(-1));
}

void init(Handle<Object> target) {
  NODE_SET_METHOD(target, "hashCode", hashCode);
}

NODE_MODULE(hash, init);
